<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Multiple Instances of an FMU · FMI.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="FMI.jl logo"/></a><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><a class="tocitem" href="../../features/">Features</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../overview/">Overview</a></li><li><a class="tocitem" href="../simulate/">Simulate an FMU in different modes</a></li><li><a class="tocitem" href="../parameterize/">Manually parameterize an FMU</a></li><li class="is-active"><a class="tocitem" href>Multiple Instances of an FMU</a><ul class="internal"><li><a class="tocitem" href="#License"><span>License</span></a></li><li><a class="tocitem" href="#Motivation"><span>Motivation</span></a></li><li><a class="tocitem" href="#Introduction-to-the-example"><span>Introduction to the example</span></a></li><li><a class="tocitem" href="#Target-group"><span>Target group</span></a></li><li><a class="tocitem" href="#Other-formats"><span>Other formats</span></a></li><li><a class="tocitem" href="#Getting-started"><span>Getting started</span></a></li><li><a class="tocitem" href="#Code-section"><span>Code section</span></a></li></ul></li><li><a class="tocitem" href="../modelica_conference_2021/">Advanced Simulation of an FMU</a></li><li><a class="tocitem" href="../manipulation/">Manipulate a function</a></li><li><a class="tocitem" href="../multithreading/">Multithreading</a></li><li><a class="tocitem" href="../multiprocessing/">Multiprocessing</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Library Functions</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../library/library/">FMI version independent library functions</a></li><li><a class="tocitem" href="../../library/fmu/">FMU version independent functions</a></li></ul></li><li><a class="tocitem" href="../../related/">Related Publication</a></li><li><a class="tocitem" href="../../contents/">Contents</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Multiple Instances of an FMU</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Multiple Instances of an FMU</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Multiple-Instances-of-an-FMU"><a class="docs-heading-anchor" href="#Multiple-Instances-of-an-FMU">Multiple Instances of an FMU</a><a id="Multiple-Instances-of-an-FMU-1"></a><a class="docs-heading-anchor-permalink" href="#Multiple-Instances-of-an-FMU" title="Permalink"></a></h1><p>Tutorial by Johannes Stoljar, Tobias Thummerer</p><h2 id="License"><a class="docs-heading-anchor" href="#License">License</a><a id="License-1"></a><a class="docs-heading-anchor-permalink" href="#License" title="Permalink"></a></h2><p>Copyright (c) 2021 Tobias Thummerer, Lars Mikelsons, Josef Kircher, Johannes Stoljar</p><p>Licensed under the MIT license. See <a href="https://github.com/thummeto/FMI.jl/blob/main/LICENSE">LICENSE</a> file in the project root for details.</p><h2 id="Motivation"><a class="docs-heading-anchor" href="#Motivation">Motivation</a><a id="Motivation-1"></a><a class="docs-heading-anchor-permalink" href="#Motivation" title="Permalink"></a></h2><p>This Julia Package <em>FMI.jl</em> is motivated by the use of simulation models in Julia. Here the FMI specification is implemented. FMI (<em>Functional Mock-up Interface</em>) is a free standard (<a href="http://fmi-standard.org/">fmi-standard.org</a>) that defines a container and an interface to exchange dynamic models using a combination of XML files, binaries and C code zipped into a single file. The user can thus use simulation models in the form of an FMU (<em>Functional Mock-up Units</em>). Besides loading the FMU, the user can also set values for parameters and states and simulate the FMU both as co-simulation and model exchange simulation.</p><h2 id="Introduction-to-the-example"><a class="docs-heading-anchor" href="#Introduction-to-the-example">Introduction to the example</a><a id="Introduction-to-the-example-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction-to-the-example" title="Permalink"></a></h2><p>In this example we want to show that it is possible to create different instances of an FMU. The different instances can then be used to run independent simulations. After the FMU has been simulated, the simulation results are displayed in a graph. The used model is a one-dimensional spring pendulum without friction. The object-orientated structure of the <em>SpringPendulum1D</em> can be seen in the following graphic.</p><p><img src="https://github.com/thummeto/FMI.jl/blob/main/docs/src/examples/pics/SpringPendulum1D.svg?raw=true" alt="svg"/>  </p><h2 id="Target-group"><a class="docs-heading-anchor" href="#Target-group">Target group</a><a id="Target-group-1"></a><a class="docs-heading-anchor-permalink" href="#Target-group" title="Permalink"></a></h2><p>The example is primarily intended for users who work in the field of simulations. The example wants to show how simple it is to use FMUs in Julia.</p><h2 id="Other-formats"><a class="docs-heading-anchor" href="#Other-formats">Other formats</a><a id="Other-formats-1"></a><a class="docs-heading-anchor-permalink" href="#Other-formats" title="Permalink"></a></h2><p>Besides, this <a href="https://github.com/thummeto/FMI.jl/blob/examples/examples/multiple_instances.ipynb">Jupyter Notebook</a> there is also a <a href="https://github.com/thummeto/FMI.jl/blob/examples/examples/multiple_instances.jl">Julia file</a> with the same name, which contains only the code cells and for the documentation there is a <a href="https://github.com/thummeto/FMI.jl/blob/examples/examples/multiple_instances.md">Markdown file</a> corresponding to the notebook.  </p><h2 id="Getting-started"><a class="docs-heading-anchor" href="#Getting-started">Getting started</a><a id="Getting-started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-started" title="Permalink"></a></h2><h3 id="Installation-prerequisites"><a class="docs-heading-anchor" href="#Installation-prerequisites">Installation prerequisites</a><a id="Installation-prerequisites-1"></a><a class="docs-heading-anchor-permalink" href="#Installation-prerequisites" title="Permalink"></a></h3><table><tr><th style="text-align: left"></th><th style="text-align: left">Description</th><th style="text-align: left">Command</th><th style="text-align: left">Alternative</th></tr><tr><td style="text-align: left">1.</td><td style="text-align: left">Enter Package Manager via</td><td style="text-align: left">]</td><td style="text-align: left"></td></tr><tr><td style="text-align: left">2.</td><td style="text-align: left">Install FMI via</td><td style="text-align: left">add FMI</td><td style="text-align: left">add &quot; https://github.com/ThummeTo/FMI.jl &quot;</td></tr><tr><td style="text-align: left">3.</td><td style="text-align: left">Install FMIZoo via</td><td style="text-align: left">add FMIZoo</td><td style="text-align: left">add &quot; https://github.com/ThummeTo/FMIZoo.jl &quot;</td></tr><tr><td style="text-align: left">4.</td><td style="text-align: left">Install Plots via</td><td style="text-align: left">add Plots</td><td style="text-align: left"></td></tr></table><h2 id="Code-section"><a class="docs-heading-anchor" href="#Code-section">Code section</a><a id="Code-section-1"></a><a class="docs-heading-anchor-permalink" href="#Code-section" title="Permalink"></a></h2><p>To run the example, the previously installed packages must be included. </p><pre><code class="language-julia"># imports
using FMI
using FMIZoo
using Plots</code></pre><h3 id="Simulation-setup"><a class="docs-heading-anchor" href="#Simulation-setup">Simulation setup</a><a id="Simulation-setup-1"></a><a class="docs-heading-anchor-permalink" href="#Simulation-setup" title="Permalink"></a></h3><p>Next, the start time and end time of the simulation are set. Finally, the recorded values are specified to store the results of the simulation.</p><pre><code class="language-julia">tStart = 0.0
tStop = 8.0

vrs = [&quot;mass.s&quot;]</code></pre><pre><code class="language-none">1-element Vector{String}:
 &quot;mass.s&quot;</code></pre><h3 id="Import-FMU"><a class="docs-heading-anchor" href="#Import-FMU">Import FMU</a><a id="Import-FMU-1"></a><a class="docs-heading-anchor-permalink" href="#Import-FMU" title="Permalink"></a></h3><p>In the next lines of code the FMU model from <em>FMIZoo.jl</em> is loaded and the information about the FMU is shown.</p><pre><code class="language-julia"># we use an FMU from the FMIZoo.jl
pathToFMU = get_model_filename(&quot;SpringPendulum1D&quot;, &quot;Dymola&quot;, &quot;2022x&quot;)

myFMU = fmiLoad(pathToFMU)
fmiInfo(myFMU)</code></pre><pre><code class="language-none">┌ Info: fmi2Unzip(...): Successfully unzipped 153 files at `/tmp/fmijl_qFMMRQ/SpringPendulum1D`.
└ @ FMIImport /home/runner/.julia/packages/FMIImport/4SJhD/src/FMI2_ext.jl:76
┌ Info: fmi2Load(...): FMU resources location is `file:////tmp/fmijl_qFMMRQ/SpringPendulum1D/resources`
└ @ FMIImport /home/runner/.julia/packages/FMIImport/4SJhD/src/FMI2_ext.jl:192
┌ Info: fmi2Load(...): FMU supports both CS and ME, using CS as default if nothing specified.
└ @ FMIImport /home/runner/.julia/packages/FMIImport/4SJhD/src/FMI2_ext.jl:195


#################### Begin information for FMU ####################
	Model name:			SpringPendulum1D
	FMI-Version:			2.0
	GUID:				{fc15d8c4-758b-48e6-b00e-5bf47b8b14e5}
	Generation tool:		Dymola Version 2022x (64-bit), 2021-10-08
	Generation time:		2022-05-19T06:54:23Z
	Var. naming conv.:		structured
	Event indicators:		0
	Inputs:				0
	Outputs:			0
	States:				2
		33554432 [&quot;mass.s&quot;]
		33554433 [&quot;mass.v&quot;]
	Supports Co-Simulation:		true
		Model identifier:	SpringPendulum1D
		Get/Set State:		true
		Serialize State:	true
		Dir. Derivatives:	true
		Var. com. steps:	true
		Input interpol.:	true
		Max order out. der.:	1
	Supports Model-Exchange:	true
		Model identifier:	SpringPendulum1D
		Get/Set State:		true
		Serialize State:	true
		Dir. Derivatives:	true
##################### End information for FMU #####################</code></pre><h3 id="First-Instance"><a class="docs-heading-anchor" href="#First-Instance">First Instance</a><a id="First-Instance-1"></a><a class="docs-heading-anchor-permalink" href="#First-Instance" title="Permalink"></a></h3><p>To create an instance of the FMU it is necessary to call the command <code>fmiInstantiate!()</code>. With the component address you now have a unique instance of the FMU.</p><pre><code class="language-julia">comp1 = fmiInstantiate!(myFMU; loggingOn=true)
comp1Address= comp1.compAddr
println(comp1)</code></pre><pre><code class="language-none">FMU:            SpringPendulum1D
InstanceName:   SpringPendulum1D
Address:        Ptr{Nothing} @0x0000000004f861e0
State:          fmi2ComponentStateInstantiated
Logging:        false
FMU time:       -Inf
FMU states:     nothing</code></pre><p>Next, a dictionary for the parameters is created. With this dictionary you can set the initial states of the variables of the FMU. For the spring constant <code>spring.c</code> a value of <span>$10.0 \frac{N}{m}$</span> and for the position of the mass <code>mass.s</code> a value of <span>$1.0 m$</span> is set. The created dictionary with the specified variables for recording are passed to the command for simulation. In addition, other keywords are set. On the one hand the keyword <code>instantiate=false</code> is set, which prevents that in the simulation command a new instance is created. On the other hand the keyword <code>freeInstance=false</code> is set, this prevents that after the simulation command the instance is released. </p><pre><code class="language-julia">param1 = Dict(&quot;spring.c&quot;=&gt;10.0, &quot;mass_s0&quot;=&gt;1.0)
data1 = fmiSimulate(comp1, tStart, tStop; parameters=param1, recordValues=vrs, instantiate=false, freeInstance=false)
fig = fmiPlot(data1)</code></pre><p><img src="../multiple_instances_files/multiple_instances_10_0.svg" alt="svg"/></p><p>For control, you can compare again the address of the instance to the previous address, and it should be the same address. As soon as this is not the case an error would be thrown by the macro <code>@assert</code>.</p><pre><code class="language-julia">@assert comp1.compAddr === comp1Address</code></pre><h3 id="Second-Instance"><a class="docs-heading-anchor" href="#Second-Instance">Second Instance</a><a id="Second-Instance-1"></a><a class="docs-heading-anchor-permalink" href="#Second-Instance" title="Permalink"></a></h3><p>To create a second instance of the FMU it is necessary to call the command <code>fmiInstantiate!()</code>. With the component address you now have a unique instance of the FMU.</p><pre><code class="language-julia">comp2 = fmiInstantiate!(myFMU; loggingOn=true)
comp2Address= comp2.compAddr
println(comp2)</code></pre><pre><code class="language-none">FMU:            SpringPendulum1D
InstanceName:   SpringPendulum1D
Address:        Ptr{Nothing} @0x00000000060a9d90
State:          fmi2ComponentStateInstantiated
Logging:        false
FMU time:       -Inf
FMU states:     nothing</code></pre><p>The addresses of the instantiated FMUs must differ, and you can see that in the comparison below.</p><pre><code class="language-julia">@assert comp1Address !== comp2Address</code></pre><p>Again, a dictionary for the parameters is created. With this dictionary you can set the initial states of the variables of the FMU. For the spring constant <code>spring.c</code> a value of <span>$1.0 \frac{N}{m}$</span> and for the position of the mass <code>mass.s</code> a value of <span>$2.0 m$</span> is set. The created dictionary with the specified variables for recording are passed to the command for simulation. As before, the two keywords <code>instantiate=false</code> and <code>freeInstance=false</code> are set.</p><pre><code class="language-julia">param2 = Dict(&quot;spring.c&quot;=&gt;1.0, &quot;mass.s&quot;=&gt;2.0)
data2 = fmiSimulateCS(comp2, tStart, tStop;  parameters=param2, recordValues=vrs, instantiate=false, freeInstance=false)
fmiPlot!(fig, data2)</code></pre><p><img src="../multiple_instances_files/multiple_instances_18_0.svg" alt="svg"/></p><p>For control, you can compare again the address of the instance <code>comp2</code> to the previous address <code>comp2Address</code> and it should be the same address.</p><pre><code class="language-julia">@assert comp2.compAddr === comp2Address</code></pre><h3 id="Unload-FMU"><a class="docs-heading-anchor" href="#Unload-FMU">Unload FMU</a><a id="Unload-FMU-1"></a><a class="docs-heading-anchor-permalink" href="#Unload-FMU" title="Permalink"></a></h3><p>After plotting the data, the FMU is unloaded and all unpacked data on disc is removed.</p><pre><code class="language-julia">fmiUnload(myFMU)</code></pre><h3 id="Summary"><a class="docs-heading-anchor" href="#Summary">Summary</a><a id="Summary-1"></a><a class="docs-heading-anchor-permalink" href="#Summary" title="Permalink"></a></h3><p>Based on the example it can be seen that it is possible to create different instances of an FMU. The different instances can then be used to perform different simulations.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../parameterize/">« Manually parameterize an FMU</a><a class="docs-footer-nextpage" href="../modelica_conference_2021/">Advanced Simulation of an FMU »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 28 June 2022 08:25">Tuesday 28 June 2022</span>. Using Julia version 1.6.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
