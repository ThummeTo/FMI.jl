<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Modelica conference 2021 Â· FMI.jl</title><meta name="title" content="Modelica conference 2021 Â· FMI.jl"/><meta property="og:title" content="Modelica conference 2021 Â· FMI.jl"/><meta property="twitter:title" content="Modelica conference 2021 Â· FMI.jl"/><meta name="description" content="Documentation for FMI.jl."/><meta property="og:description" content="Documentation for FMI.jl."/><meta property="twitter:description" content="Documentation for FMI.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="FMI.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><a class="tocitem" href="../../features/">Features</a></li><li><a class="tocitem" href="../../faq/">FAQ</a></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../overview/">Overview</a></li><li><a class="tocitem" href="../simulate/">Simulate</a></li><li><a class="tocitem" href="../parameterize/">Parameterize</a></li><li><a class="tocitem" href="../inputs/">Inputs</a></li><li><a class="tocitem" href="../multiple_instances/">Multiple instances</a></li><li class="is-active"><a class="tocitem" href>Modelica conference 2021</a><ul class="internal"><li><a class="tocitem" href="#License"><span>License</span></a></li><li><a class="tocitem" href="#Introduction-to-the-example"><span>Introduction to the example</span></a></li><li><a class="tocitem" href="#Other-formats"><span>Other formats</span></a></li><li><a class="tocitem" href="#Code-section"><span>Code section</span></a></li></ul></li><li><a class="tocitem" href="../manipulation/">Manipulation</a></li><li><a class="tocitem" href="../multithreading/">Multithreading</a></li><li><a class="tocitem" href="../multiprocessing/">Multiprocessing</a></li><li><a class="tocitem" href="../workshops/">Pluto Workshops</a></li></ul></li><li><a class="tocitem" href="../../library/">User Level API - FMI.jl</a></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Developer Level API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-6-1" type="checkbox"/><label class="tocitem" for="menuitem-6-1"><span class="docs-label">fmi version independent content</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../fmi_lowlevel_library_constants/">Types in FMI Import/Core .jl</a></li><li><a class="tocitem" href="../../fmi_lowlevel_modeldescription_functions/">Working with the FMI model description</a></li><li><a class="tocitem" href="../../fmi_lowlevel_library_functions/">Functions in FMI Import/Core .jl</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-2" type="checkbox"/><label class="tocitem" for="menuitem-6-2"><span class="docs-label">FMI2 specific content</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../fmi2_lowlevel_library_constants/">FMI2 Types in FMI Import/Core .jl</a></li><li><input class="collapse-toggle" id="menuitem-6-2-2" type="checkbox"/><label class="tocitem" for="menuitem-6-2-2"><span class="docs-label">FMI2 Functions in FMI Import/Core .jl</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../fmi2_lowlevel_modeldescription_functions/">Working with the FMI model description</a></li><li><a class="tocitem" href="../../fmi2_lowlevel_library_functions/">FMI Common Concepts for Model Exchange and Co-Simulation</a></li><li><a class="tocitem" href="../../fmi2_lowlevel_ME_functions/">FMI for Model Exchange</a></li><li><a class="tocitem" href="../../fmi2_lowlevel_CS_functions/">FMI for Co-Simulation</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-3" type="checkbox"/><label class="tocitem" for="menuitem-6-3"><span class="docs-label">FMI3 specific content</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../fmi3_lowlevel_library_constants/">FMI3 Types in FMI Import/Core .jl</a></li><li><input class="collapse-toggle" id="menuitem-6-3-2" type="checkbox"/><label class="tocitem" for="menuitem-6-3-2"><span class="docs-label">FMI3 Functions in FMI Import/Core .jl</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../fmi3_lowlevel_modeldescription_functions/">Working with the FMI model description</a></li><li><a class="tocitem" href="../../fmi3_lowlevel_library_functions/">FMI Common Concepts for Model Exchange and Co-Simulation</a></li><li><a class="tocitem" href="../../fmi3_lowlevel_ME_functions/">FMI for Model Exchange</a></li><li><a class="tocitem" href="../../fmi3_lowlevel_CS_functions/">FMI for Co-Simulation</a></li><li><a class="tocitem" href="../../fmi3_lowlevel_SE_functions/">FMI for Scheduled Execution</a></li></ul></li></ul></li></ul></li><li><a class="tocitem" href="../../index_library/">API Index</a></li><li><a class="tocitem" href="../../fmi-tool-info/">FMI Tool Information</a></li><li><a class="tocitem" href="../../related/">Related Publication</a></li><li><a class="tocitem" href="../../contents/">Contents</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Modelica conference 2021</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Modelica conference 2021</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ThummeTo/FMI.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ï‚›</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Example-from-the-Modelica-Conference-2021"><a class="docs-heading-anchor" href="#Example-from-the-Modelica-Conference-2021">Example from the Modelica Conference 2021</a><a id="Example-from-the-Modelica-Conference-2021-1"></a><a class="docs-heading-anchor-permalink" href="#Example-from-the-Modelica-Conference-2021" title="Permalink"></a></h1><p>Tutorial by Tobias Thummerer, Johannes Stoljar</p><p>This example was updated over time to keep track with developments and changes in <em>FMI.jl</em>.</p><p>ðŸš§ This tutorial is under revision and will be replaced by an up-to-date version soon ðŸš§</p><h2 id="License"><a class="docs-heading-anchor" href="#License">License</a><a id="License-1"></a><a class="docs-heading-anchor-permalink" href="#License" title="Permalink"></a></h2><pre><code class="language-julia hljs"># Copyright (c) 2021 Tobias Thummerer, Lars Mikelsons, Josef Kircher, Johannes Stoljar
# Licensed under the MIT license. 
# See LICENSE (https://github.com/thummeto/FMI.jl/blob/main/LICENSE) file in the project root for details.</code></pre><h2 id="Introduction-to-the-example"><a class="docs-heading-anchor" href="#Introduction-to-the-example">Introduction to the example</a><a id="Introduction-to-the-example-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction-to-the-example" title="Permalink"></a></h2><p>FMUs can be simulated in multiple ways using <em>FMI.jl</em>. You can use a very simple interface, that offers possibilities that satisfy almost any user requirement. However, if you need to build a custom simulation loop for your use case using the core FMI functions, we show that too.</p><p><img src="https://github.com/thummeto/FMI.jl/blob/main/docs/src/examples/pics/SpringFrictionPendulum1D.svg?raw=true" alt="svg"/>  </p><h2 id="Other-formats"><a class="docs-heading-anchor" href="#Other-formats">Other formats</a><a id="Other-formats-1"></a><a class="docs-heading-anchor-permalink" href="#Other-formats" title="Permalink"></a></h2><p>Besides, this <a href="https://github.com/thummeto/FMI.jl/blob/examples/examples/src/modelica_conference_2021.ipynb">Jupyter Notebook</a> there is also a <a href="https://github.com/thummeto/FMI.jl/blob/examples/examples/src/modelica_conference_2021.jl">Julia file</a> with the same name, which contains only the code cells and for the documentation there is a <a href="https://github.com/thummeto/FMI.jl/blob/examples/examples/src/modelica_conference_2021.md">Markdown file</a> corresponding to the notebook.  </p><h2 id="Code-section"><a class="docs-heading-anchor" href="#Code-section">Code section</a><a id="Code-section-1"></a><a class="docs-heading-anchor-permalink" href="#Code-section" title="Permalink"></a></h2><p>To run the example, the previously installed packages must be included. </p><pre><code class="language-julia hljs"># imports
using FMI
using FMIZoo
using Plots</code></pre><h3 id="Simulation-setup"><a class="docs-heading-anchor" href="#Simulation-setup">Simulation setup</a><a id="Simulation-setup-1"></a><a class="docs-heading-anchor-permalink" href="#Simulation-setup" title="Permalink"></a></h3><p>Next, the start time and end time of the simulation are set. Finally, a step size is specified to store the results of the simulation at these time steps.</p><pre><code class="language-julia hljs">tStart = 0.0
tStep = 0.1
tStop = 8.0
tSave = tStart:tStep:tStop</code></pre><pre><code class="nohighlight hljs">0.0:0.1:8.0</code></pre><h3 id="Simple-FMU-Simulation"><a class="docs-heading-anchor" href="#Simple-FMU-Simulation">Simple FMU Simulation</a><a id="Simple-FMU-Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Simple-FMU-Simulation" title="Permalink"></a></h3><p>Next, the FMU model from <em>FMIZoo.jl</em> is loaded and the information about the FMU is shown.</p><pre><code class="language-julia hljs"># we use an FMU from the FMIZoo.jl
fmu = loadFMU(&quot;SpringFrictionPendulum1D&quot;, &quot;Dymola&quot;, &quot;2022x&quot;)
info(fmu)</code></pre><pre><code class="nohighlight hljs">#################### Begin information for FMU ####################
	Model name:			SpringFrictionPendulum1D
	FMI-Version:			2.0
	GUID:				{2e178ad3-5e9b-48ec-a7b2-baa5669efc0c}
	Generation tool:		Dymola Version 2022x (64-bit), 2021-10-08
	Generation time:		2022-05-19T06:54:12Z
	Var. naming conv.:		structured
	Event indicators:		24
	Inputs:				0
	Outputs:			0
	States:				2
		33554432 [&quot;mass.s&quot;]
		33554433 [&quot;mass.v&quot;, &quot;mass.v_relfric&quot;]
	Parameters:			12
		16777216 [&quot;fricScale&quot;]
		16777217 [&quot;s0&quot;]
		16777218 [&quot;v0&quot;]
		16777219 [&quot;fixed.s0&quot;]
		...
		16777223 [&quot;mass.smin&quot;]
		16777224 [&quot;mass.v_small&quot;]
		16777225 [&quot;mass.L&quot;]
		16777226 [&quot;mass.m&quot;]
		16777227 [&quot;mass.fexp&quot;]


	Supports Co-Simulation:		true
		Model identifier:	SpringFrictionPendulum1D
		Get/Set State:		true
		Serialize State:	true
		Dir. Derivatives:	true
		Var. com. steps:	true
		Input interpol.:	true
		Max order out. der.:	1
	Supports Model-Exchange:	true
		Model identifier:	SpringFrictionPendulum1D
		Get/Set State:		true
		Serialize State:	true
		Dir. Derivatives:	true
##################### End information for FMU #####################</code></pre><h3 id="Easy-Simulation"><a class="docs-heading-anchor" href="#Easy-Simulation">Easy Simulation</a><a id="Easy-Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Easy-Simulation" title="Permalink"></a></h3><p>In the next commands the FMU is simulated, for which the start and end time and recorded variables are declared. Afterwards the simulation result is plotted. In the plot for the FMU, it can be seen that the oscillation keeps decreasing due to the effect of friction. If one simulates long enough, the oscillation comes to a standstill after a certain time.</p><pre><code class="language-julia hljs">simData = simulate(fmu, (tStart, tStop); recordValues=[&quot;mass.s&quot;], saveat=tSave)
plot(simData)</code></pre><p><img src="../modelica_conference_2021_files/modelica_conference_2021_10_0.svg" alt="svg"/></p><p>After plotting the data, the FMU is unloaded and all unpacked data on disc is removed.</p><pre><code class="language-julia hljs">unloadFMU(fmu)</code></pre><h3 id="Custom-Simulation"><a class="docs-heading-anchor" href="#Custom-Simulation">Custom Simulation</a><a id="Custom-Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-Simulation" title="Permalink"></a></h3><p>In the following type of simulation a more advanced variant is presented, which allows intervening more in the simulation process. Analogous to the simple variant, an FMU model must be loaded.</p><pre><code class="language-julia hljs">fmu = loadFMU(&quot;SpringFrictionPendulum1D&quot;, &quot;Dymola&quot;, &quot;2022x&quot;)</code></pre><pre><code class="nohighlight hljs">Model name:	SpringFrictionPendulum1D
Type:		1</code></pre><p>Next, it is necessary to create an instance of the FMU, this is achieved by the command <code>fmi2Instantiate!()</code>.  </p><pre><code class="language-julia hljs">instanceFMU = fmi2Instantiate!(fmu)</code></pre><pre><code class="nohighlight hljs">FMU:            SpringFrictionPendulum1D
    InstanceName:   SpringFrictionPendulum1D
    Address:        Ptr{Nothing} @0x00000242178238e0
    State:          0
    Logging:        false
    FMU time:       -Inf
    FMU states:     nothing</code></pre><p>In the following code block, start and end time for the simulation is set by the <code>fmi2SetupExperiment()</code> command. Next, the FMU is initialized by the calls of <code>fmi2EnterInitializationMode()</code> and <code>fmi2ExitInitializationMode()</code>. It would also be possible to set initial states, parameters or inputs at this place in code.</p><pre><code class="language-julia hljs">fmi2SetupExperiment(instanceFMU, tStart, tStop)
# set initial model states
fmi2EnterInitializationMode(instanceFMU)
# get initial model states
fmi2ExitInitializationMode(instanceFMU)</code></pre><pre><code class="nohighlight hljs">0x00000000</code></pre><p>The actual simulation loop is shown in the following block. Here a simulation step <code>fmi2DoStep()</code> with the fixed step size <code>tStep</code> is executed. As indicated in the code by the comments, the input values and output values of the FMU could be changed in the simulation loop as desired, whereby the higher possibility of adjustments arises.</p><pre><code class="language-julia hljs">values = []

for t in tSave
    # set model inputs if any
    # ...

    fmi2DoStep(instanceFMU, tStep)
    
    # get model outputs
    value = fmi2GetReal(instanceFMU, &quot;mass.s&quot;)
    push!(values, value)
end

plot(tSave, values)</code></pre><p><img src="../modelica_conference_2021_files/modelica_conference_2021_20_0.svg" alt="svg"/></p><p>The instantiated FMU must be terminated and then the memory area for the instance can also be deallocated. The last step is to unload the FMU to remove all unpacked data on disc. </p><pre><code class="language-julia hljs">fmi2Terminate(instanceFMU)
fmi2FreeInstance!(instanceFMU)
unloadFMU(fmu)</code></pre><h3 id="Summary"><a class="docs-heading-anchor" href="#Summary">Summary</a><a id="Summary-1"></a><a class="docs-heading-anchor-permalink" href="#Summary" title="Permalink"></a></h3><p>The tutorial has shown how to use the default simulation command and how to deploy a custom simulation loop.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../multiple_instances/">Â« Multiple instances</a><a class="docs-footer-nextpage" href="../manipulation/">Manipulation Â»</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Monday 9 December 2024 14:13">Monday 9 December 2024</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
